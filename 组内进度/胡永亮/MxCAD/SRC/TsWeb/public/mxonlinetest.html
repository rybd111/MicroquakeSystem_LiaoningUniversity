<!DOCTYPE html>
<html style="height: 100%" lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312">
    <meta name="GENERATOR" content="Microsoft FrontPage 4.0">
    <meta name="ProgId" content="FrontPage.Editor.Document">
    <title>MxWeb3D1.0在线测试</title>
    <link rel="stylesheet" href="./onlinetest/css/docs.css">
    <link rel="stylesheet" href="./onlinetest/css/styles.min.css">
    <link rel="stylesheet" href="./onlinetest/css/main1.css">
    <link rel="stylesheet" href="./onlinetest/codemirror/CodeMirror-2.22/theme/rubyblue.css">
    <link rel="stylesheet" href="./onlinetest/codemirror/CodeMirror-2.22/lib/codemirror.css">
    <link rel="stylesheet" href="./onlinetest/codemirror/CodeMirror-2.22/lib/util/simple-hint.css">
    <link rel="stylesheet" href="./onlinetest/css/mxcss.css">
    <script src="./onlinetest/codemirror/CodeMirror-2.22/lib/codemirror.js"></script>
    <script src="./onlinetest/codemirror/CodeMirror-2.22/lib/util/simple-hint.js"></script>
    <script src="./onlinetest/codemirror/CodeMirror-2.22/lib/util/javascript-hint.js"></script>
    <script src="./onlinetest/codemirror/CodeMirror-2.22/mode/javascript/javascript.js"></script>

    <script language="javascript" type="text/javascript">

        var uiObj = undefined;
        var MxFun = undefined;
        var McEdJigCommand = undefined;
        var mxCmdManager = undefined;
        var AcquireStatus;
        var DragStatus;
        var DoneStatius;
        var InType;
        var MouseButton;
        var THREE;

        function MxMain(require) {
            MxFun = require("./MxFun").MxFun;
            THREE = MxFun.getTHREE();

            mxCmdManager = require("./MxJigCmdManager").MxCommandManager;
            McEdJigCommand = mxCmdManager.getMcEdJigCommandClass();

            AcquireStatus = mxCmdManager.AcquireStatus;
            DragStatus = mxCmdManager.DragStatus;
            DoneStatius = mxCmdManager.DoneStatius;
            InType = mxCmdManager.InType;
            MouseButton = mxCmdManager.MouseButton;

            var mxDraw = MxFun.createMxObject("MxWeb3D",undefined, function (mxDraw) {

                if (!MxFun.is2dParam()) {
                    mxDraw.addEvent("initRenderer", function (renderer) {
                        renderer.shadowMap.enabled = true;
                        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                    });

                    mxDraw.addEvent("initScene", function (scene) {

                        // 创建光源
                        {

                            //半球光
                            var hemisphereLight = new THREE.HemisphereLight(0xffffff, 0xffffff, .7);
                            scene.add(hemisphereLight);

                            //平行光
                            var directionalLight = new THREE.DirectionalLight(0x777777, .6);
                            directionalLight.position.set(-40, 60, -10);
                            directionalLight.castShadow = true;
                            directionalLight.shadow.camera.near = 2;
                            directionalLight.shadow.camera.far = 200;
                            directionalLight.shadow.camera.left = -50;
                            directionalLight.shadow.camera.right = 50;
                            directionalLight.shadow.camera.top = 50;
                            directionalLight.shadow.camera.bottom = -50;

                            directionalLight.distance = 0;
                            directionalLight.intensity = 0.5;
                            directionalLight.shadow.mapSize.height = 1024;
                            directionalLight.shadow.mapSize.width = 1024;
                            scene.add(directionalLight);

                            //房间模型加载案列灯光
                            var spotLight = new THREE.SpotLight("#0c0c0c");
                            spotLight.position.set(-180, 250, 50);
                            spotLight.castShadow = true;//开启灯光投射阴影
                            spotLight.shadow.mapSize.height = 1024;
                            spotLight.shadow.mapSize.width = 1024;
                            scene.add(spotLight);


                            var ambientLight = new THREE.AmbientLight("#0c0c0c");
                            scene.add(ambientLight);





                        }

                        // 底部网格
                        {
                            var helper = new THREE.GridHelper(2000, 100);
                            helper.position.y = - 199;
                            helper.material.opacity = 0.25;
                            helper.material.transparent = true;
                            scene.add(helper);
                        }

                        // 坐标系
                        {
                            var axes = new THREE.AxesHelper(20);//参数设置了三条轴线的长度
                            scene.add(axes);
                        }
                    });
                }
            });


            MxFun.setOutServerDebugCall(function (value) {
                alert(value);
                console.log(value);
            });
            document.body.addEventListener('touchmove', function (e) {
                e.preventDefault()
            }, { passive: false })

            return 0;
        }

    </script>


    <script language="javascript" type="text/javascript" src="js/jquery.js"></script>
    <script language="javascript" type="text/javascript" src="js/mxfun.min.js"></script>
    <script language="javascript" type="text/javascript" src="user/mx2d.js"></script>
    <script language="javascript" type="text/javascript" src="user/mx3d.js"></script>
</head>
<SCRIPT language="JavaScript">
    document.oncontextmenu = new Function('event.returnValue=false;'); //禁用右键
</SCRIPT>

<body style="height: 100%;width: 100%;overflow-x: hidden;overflow-y: hidden">

    <div id="header" style="height: 50px;background-color: #06C;">
        <h2 style="color: #fff;
    line-height: 50px;
    font-size: 20px;
    text-indent: 1em;margin: 0px">
            MxWeb3D1.0在线测试
        </h2>
        <div style="position: absolute;right: 25px;top: 0;line-height: 50px;">
            <a href="http://www.mxdraw.com/" style="color: #fff;text-decoration: none">
                <h3 style="font-size: 14px;">返回首页</h3>
            </a>
        </div>
    </div>


    <div id="content">
        <div id="menu">

        </div>


        <div id="mybox" style="width: 85%;height: 100%;float: right;overflow: hidden">
            <div id="code_area_box" style=" width:calc(30% - 5px);   /*width: 30%;*/
    -webkit-user-select: none;
    float: left;
    height: 100%;
    z-index: 999;
    position: relative;
    border: 1px solid #F7F9FD;overflow: hidden">
                <!--前端源代码编辑-->
                <div class="code_area">

                    <div class="openbar" unselectable="on">
                        <div class="d_menu">
                            <div class="d_clip_container"><a data-clipboard-target="#myresource" class="d_clip_button"
                                    class="copy" onclick="copyUrl2(); ">复制</a></div>
                            <div class="d_run_container"><a class="d_run_button" class="run" onclick="runCode();">运行</a>
                            </div>
                            <div class="d_refresh_container"><a class="d_refresh_button" id="d_refresh_button">刷新</a>
                            </div>
                            <!-- <div class="d_help_container"><a class="d_help_button" href="http://www.mxdraw.com/help_5_71.html" target="_blank">帮助</a></div> -->
                        </div>
                        <p>前端源代码编辑器</p>


                    </div>
                    <!--<textarea class="form-control" id="code" name="code" role="8" cols="50" style="width: 100%;height: 100%;overflow-x:scroll;background: #ffffff; border:none"></textarea>-->

                    <div class="CodeMirror">
                        <textarea class="form-control" id="code" name="code" role="8" cols="50"
                            style="width: 100%;height: 100%;overflow-x:scroll;background: #ffffff; border:none"></textarea>
                    </div>
                    <textarea id="mycopycode" style="display: none;">   </textarea>
                    <div id="one" style="display: none;"> </div>


                </div>

                <!--后端源代码编辑-->
                <div class="code_area">

                    <div class="openbar" unselectable="on">
                        <div class="d_menu">
                            <div class="d_clip_container"><a data-clipboard-target="#myresource" class="d_clip_button"
                                    class="copy" onclick="copyUrl3(); ">复制</a></div>
                            <div class="d_run_container"><a class="d_run_button" class="run"
                                    onclick="runCodeToServer();">运行</a></div>
                            <div class="d_refresh_container"><a class="d_refresh_button" id="d_refresh_button1">刷新</a>
                            </div>
                            <!-- <div class="d_help_container"><a class="d_help_button" href="http://www.mxdraw.com/help_5_71.html" target="_blank">帮助</a></div> -->
                        </div>
                        <p>后端源代码编辑器</p>


                    </div>
                    <!--<textarea class="form-control" id="code" name="code" role="8" cols="50" style="width: 100%;height: 100%;overflow-x:scroll;background: #ffffff; border:none"></textarea>-->

                    <div class="CodeMirror">
                        <textarea class="form-control" id="code1" name="code" role="8" cols="50"
                            style="width: 100%;height: 100%;overflow-x:scroll;background: #ffffff; border:none"></textarea>
                    </div>
                    <textarea id="mycopycode1" style="display: none;">   </textarea>
                    <div id="one1" style="display: none;"> </div>


                </div>
                <div id="code_close" style="display: block;    background: url(ui/image/result.png) no-repeat 0 -142px;width: 14px;
    height: 90px;
    position: absolute;
    right: 0;
    z-index: 9999;
    top: 50%;
    margin-top: -45px;"></div>

            </div>

            <div id="drag" style="    width: 5px;
    height: 100%;
    background: #f1f2f7;
    cursor: w-resize;
    float: left;"></div>

            <div id="canvasdiv" style="float: right;height:100%;width:70%;position: relative">
                <div id="code_open" style="display: none; background: url(ui/image/result.png) no-repeat 0 -242px;
    width: 14px;
    height: 90px;
    position: absolute;
    z-index: 9999;
    top: 50%;
    margin-top: -45px;"></div>
                <canvas id="MxWeb3D" width="1200" height="1200"></canvas>
            </div>
        </div>


    </div>
    <script>

        $("#code_close").click(function () {
            $(this).css("display", "none");
            $("#code_area_box").css("width", "0%");
            $("#code_open").css("display", "block");
            $("#canvasdiv").css("width", "99.5%");
        })
        $("#code_open").click(function () {
            $(this).css("display", "none");
            $("#code_area_box").css("width", "30%");
            $("#code_close").css("display", "block");
            $("#canvasdiv").css("width", "69.5%");
        })

    </script>
    <script type="text/javascript">

        function crateItem2(but) {
            var ret = '';
            ret += '<dd><a class="container" ';
            ret += 'onclick=\'DoThing(this ,"' + but.code + '","' + but.codeSever + '")\'';
            ret += '>' + but.name + '</a>';
            ret += '</dd>';
            return ret;
        }

        function createItem(item) {
            var ret = '<li>';
            ret += '<a class="one_head" onclick="hide(this)"><i class="t_close"></i>' + item.title + '</a>'
            ret += '<div  class="submenu" style="display: none;">';
            ret += '<dl>';

            for (var i in item.buts)
                ret += crateItem2(item.buts[i]);

            ret += '</dl>';
            ret += '</div>';
            ret += '</li>';
            return ret;
        }

        function createMenuContent(data) {
            var ret = '<ul>';
            for (var i = 0; i < data.length; i++) {
                ret += createItem(data[i]);
            }
            ret += '</ul>';
            return ret;
        }

        function createMenu(data) {
            $('#menu').append(createMenuContent(data));
        }
    </script>

    <script type="text/javascript">
        $(function () {

            var data;

            if (MxFun.is2dParam()) {
                data = [
                    {
                        title: "2D参数化绘图",
                        buts: [
                            { name: "绘制直线", code: "drawline.js", codeSever: "drawline_server.js" },
                            { name: "绘制圆,圆弧", code: "drawcircle.js", codeSever: "drawcircle_server.js" },
                            { name: "绘制Polyline", code: "drawpolyline.js", codeSever: "drawpolyline_server.js" },
                            { name: "绘制填充", code: "drawhatch.js", codeSever: "drawhatch_server.js" },
                            { name: "绘制文字", code: "drawtext.js", codeSever: "drawtext_server.js" },
                            { name: "绘制对齐标注", code: "drawAlignedDimension.js", codeSever: "drawdimension_server.js" },
                            { name: "绘制旋转标注", code: "drawRotatedDimension.js", codeSever: "drawdimension_server.js" },
                        ]
                    },

                    {
                        title: "测试选择集",
                        buts: [
                            { name: "得到图上所有对象", code: "select.js", codeSever: "select_server.js" },
                            { name: "过滤得到所有点对象", code: "selectfilter.js", codeSever: "select_server.js" },
                            { name: "得到两点范围内的对象", code: "cossingSelect.js", codeSever: "cossingSelect_server.js" },

                        ]
                    },
                    {
                        title: "图层",
                        buts: [
                            { name: "得到所有图层名", code: "layer.js", codeSever: "layer_server.js" },

                        ]
                    },
                ];
            }
            else {
                data = [
                    {
                        title: "3D参数化绘图",
                        buts: [
                            { name: "绘制方块", code: "3dbox.js", codeSever: "3dbox_server.js" },
                            { name: "绘制圆柱", code: "drawcylinder.js", codeSever: "drawcylinder_server.js" },
                            { name: "绘制圆锥", code: "3dcone.js", codeSever: "3dcone_server.js" },
                            { name: "绘制球体", code: "3dshpere.js", codeSever: "3dshpere_server.js" },
                            { name: "绘制圆环", code: "3dtorus.js", codeSever: "3dtorus_server.js" },
                            { name: "绘制契形", code: "3dwedge.js", codeSever: "3dwedge_server.js" },
                            { name: "拉伸创建", code: "3dprism.js", codeSever: "3dprism_server.js" },
                            { name: "旋转创建", code: "3drevol.js", codeSever: "3drevol_server.js" },
                            { name: "截面放样", code: "3dthrusection.js", codeSever: "3dthrusection_server.js" },
                            { name: "创建管道", code: "3dMakePipe.js", codeSever: "3dMakePipe_server.js" },
                        ]
                    },
                    {
                        title: "3D几何运算",
                        buts: [
                            { name: "形位变换", code: "3dtransform.js", codeSever: "3dtransform_server.js" },
                            { name: "面部遍历", code: "3dexplorper.js", codeSever: "3dexplorper_server.js" },
                            { name: "布尔运算", code: "3dbooloperation.js", codeSever: "3dbooloperation_server.js" },
                            { name: "导角运算", code: "3dchamfer.js", codeSever: "3dchamfer_server.js" },
                        ]
                    },

                    {
                        title: "3D几何绘线",
                        buts: [
                            { name: "直线", code: "3dGeomLine.js", codeSever: "3dGeomLine_server.js" },
                            { name: "圆", code: "3dGeomCircle.js", codeSever: "3dGeomCircle_server.js" },
                            { name: "椭圆", code: "3dGeomEllipse.js", codeSever: "3dGeomEllipse_server.js" },
                            { name: "双曲线", code: "3dGeomHyperbola.js", codeSever: "3dGeomHyperbola_server.js" },
                            { name: "抛物线", code: "3dGeomParabola.js", codeSever: "3dGeomParabola_server.js" },
                            { name: "b样条线", code: "3dGeomBSplineCurve.js", codeSever: "3dGeomBSplineCurve_server.js" },
                            { name: "贝塞尔线", code: "3dGeomBezierCurve.js", codeSever: "3dGeomBezierCurve_server.js" },
                        ]
                    },

                    {
                        title: "3D几何绘面",
                        buts: [
                            { name: "平面", code: "3dGePlaneSurface.js", codeSever: "3dGePlaneSurface_server.js" },
                            { name: "球面", code: "3dGeSphereSurface.js", codeSever: "3dGeSphereSurface_server.js" },
                            { name: "环面", code: "3dGeToroidalSurface.js", codeSever: "3dGeToroidalSurface_server.js" },
                            { name: "柱面", code: "3dGeCylindrSurface.js", codeSever: "3dGeCylindrSurface_server.js" },
                            { name: "棱锥面", code: "3dGeConicalSurface.js", codeSever: "3dGeConicalSurface_server.js" },
                            { name: "BSpline面", code: "3dGeBSplinesurface.js", codeSever: "3dGeBSplinesurface_server.js" },
                            { name: "Bezier面", code: "3dGeBezierSurface.js", codeSever: "3dGeBezierSurface_server.js" },
                        ]
                    },
                    {
                        title: "3D标注",
                        buts: [
                            { name: "长度标注", code: "3dDimension.js", codeSever: "3dDimension_server.js" },
                            { name: "半径标注", code: "3dRadiusDimension.js", codeSever: "3dRadiusDimension_server.js" },
                            { name: "角度标注", code: "3dAngelDimension.js", codeSever: "3dAngelDimension_server.js" },
                        ]
                    },

                    {
                        title: "3d文字",
                        buts: [
                            { name: "绘制文字", code: "3dText.js", codeSever: "3dText_server.js" },

                        ]
                    },

                    {
                        title: "弧形窗户",
                        buts: [
                            { name: "弧形窗户", code: "3dSecWindows.js", codeSever: "3dSecWindows_server.js" },

                        ]
                    },

                    {
                        title: "纹理",
                        buts: [
                            { name: "贴纹理", code: "3dTexture.js", codeSever: "3dTexture_server.js" },
                            { name: "test", code: "3dTest.js", codeSever: "3dTest_server.js" },

                        ]
                    },
                    {
                        title: "阴影",
                        buts: [
                            { name: "阴影属性", code: "3dshadow.js", codeSever: "3dshadow_server.js" },

                        ]
                    },
                    {
                        title: "案例",
                        buts: [
                            { name: "瓶子案列", code: "3dMakeBottle.js", codeSever: "3dMakeBottle_server.js" },
                            { name: "窗户案列", code: "3dCreateWindows.js", codeSever: "3dCreateWindows_server.js" },
                            { name: "窗户截面", code: "3dSectWindows.js", codeSever: "3dSectWindows_server.js" },
                            { name: "弧形窗", code: "3dArcWindows.js", codeSever: "3dArcWindows_server.js" },
                            { name: "阳光房", code: "3dSunRoom.js", codeSever: "3dSunRoom_server.js" },
                            { name: "室内地图", code: "3dShowMap.js", codeSever: "3dShowMap_server.js" },
                            { name: "创建房间", code: "3dCreateRoom.js", codeSever: "3dCreateRoom_server.js" },
                        ]
                    },
                    {
                        title: "测试",
                        buts: [

                            { name: "test", code: "3dTest.js", codeSever: "3dTest_server.js" },
                            { name: "testreadstl", code: "3dTestreadstl.js", codeSever: "3dTestreadstl_server.js" },

                        ]
                    },
                ];
            }


            createMenu(data);

        });
    </script>


    <script>
        $(document).ready(function () {

            // $('#firstbtn').click()

        });
    </script>

    <!--前端代码运行部分-->
    <script>

        function runCode(data) {
            if (data) {
                var data = data;
            } else {
                var data = editor.getValue();

            }
            eval(data);

        }

    </script>

    <!--后端代码运行部分-->
    <script>

        function runCodeToServer(data) {
            if (data) {
                var data = data;
            } else {
                var data = editor1.getValue();

            }

            MxFun.loadCodeToServer(data, function (ret) {
                if (ret == "ok")
                    alert(ret);
                else
                    console.log(ret);

            });

        }

    </script>

    <script>
        var nowSrc;
        var nowSrcToServer;

        //前端代码编辑
        var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
            lineNumbers: true,//显示行号
            matchBrackets: true,//括号匹配
            //mode: "text/html",//实现javascript代码高亮
            indentUnit: 4,//缩进单位，值为空格数，默认为2 
            indentWithTabs: true,
            tabMode: "indent",
            //scrollbarStyle: "null",
            //theme: "rubyblue",	//设置主题
            lineWrapping: true,	//代码折叠
            //readOnly: true,        //只读
            extraKeys: { "Ctrl-Space": function (cm) { CodeMirror.simpleHint(cm, CodeMirror.javascriptHint); } }
        });



        //后端代码编辑
        var editor1 = CodeMirror.fromTextArea(document.getElementById("code1"), {
            lineNumbers: true,//显示行号
            matchBrackets: true,//括号匹配
            //mode: "text/html",//实现javascript代码高亮
            indentUnit: 4,//缩进单位，值为空格数，默认为2
            indentWithTabs: true,
            tabMode: "indent",
            //scrollbarStyle: "null",
            //theme: "rubyblue",	//设置主题
            lineWrapping: true,	//代码折叠
            //readOnly: true,        //只读
            extraKeys: { "Ctrl-Space": function (cm) { CodeMirror.simpleHint(cm, CodeMirror.javascriptHint); } }
        });


        $(".CodeMirror-scroll").hover(function () {
            $(this).get(0).style.cursor = "text";
        });


        function show(obj) {
            var _this = obj;
            _this.nextElementSibling.style.display = "block";
            _this.style.color = "#06C";
            var one_head = document.getElementsByClassName('one_head');
            for (var j = 0; j < one_head.length; j++) {
                if (one_head[j] != _this) {
                    one_head[j].style.color = "#000";
                    one_head[j].children[0].style.backgroundPositionX = "0";
                    one_head[j].children[0].style.backgroundPositionY = "-96px";
                    one_head[j].setAttribute("onclick", "show(this)");

                }
            }
            var submenus = document.getElementsByClassName('submenu');
            for (var i = 0; i < submenus.length; i++) {
                if (submenus[i] != _this.nextElementSibling) {
                    submenus[i].style.display = "none";
                }
            }
            _this.children[0].style.backgroundPositionX = "0";
            _this.children[0].style.backgroundPositionY = "-119px";
            _this.setAttribute("onclick", "hide(this)");
        }

        function hide(obj) {
            var _this = obj;
            _this.style.color = "#000";
            _this.nextElementSibling.style.display = "none";
            _this.children[0].style.backgroundPositionX = "0";
            _this.children[0].style.backgroundPositionY = "-96px";
            _this.setAttribute("onclick", "show(this)");
        }

        function DoThing(obj, code, codeServer) {

            var _this = obj;
            _this.classList.add("clickState");
            var containers = document.getElementsByClassName('container');
            for (var i = 0; i < containers.length; i++) {
                if (containers[i] != _this) {
                    containers[i].classList.remove("clickState");
                }
            }
            ChangeSrc(code, codeServer);
        }

        //点击左侧按钮实现展示效果
        function ChangeSrc(src, src_server) {

            src = "onlinetest/" + src;
            src_server = "onlinetest/" + src_server;

            $.ajax({
                type: "get",
                url: src,
                dataType: "text",
                async: true
            }).done(function (data) {

                editor.setValue(data);

                $("#code").val(data);

                nowSrc = src;



            });

            $.ajax({
                type: "get",
                url: src_server,
                dataType: "text",
                async: true
            }).done(function (data) {

                editor1.setValue(data);
                $("#code").val(data);

                nowSrcToServer = src_server;


            });

        }


        //前端代码复制部分
        function copyUrl2() {

            var data = editor.getValue();

            $('#mycopycode').val(data);
            $('#mycopycode').show();

            var mycopycode = document.getElementById("mycopycode");
            mycopycode.select(); // 选择对象 
            document.execCommand("Copy"); // 执行浏览器复制命令 
            alert("已复制好，可贴粘。");
            $('#mycopycode').hide();

        }

        //后端代码复制部分
        function copyUrl3() {

            var data = editor1.getValue();

            $('#mycopycode1').val(data);
            $('#mycopycode1').show();

            var mycopycode1 = document.getElementById("mycopycode1");
            mycopycode1.select(); // 选择对象 
            document.execCommand("Copy"); // 执行浏览器复制命令 
            alert("已复制好，可贴粘。");
            $('#mycopycode1').hide();

        }


        //前端源代码刷新部分
        //点击刷新按钮回到修改前的效果
        $("#d_refresh_button").click(function () {
            if (nowSrc) {

                $.ajax({
                    type: "get",
                    url: nowSrc,
                    dataType: "text",
                    async: true
                }).done(function (data) {
                    editor.setValue(data)
                    $("#code").val(data);


                });


            }
        });



        //后端源代码刷新部分
        //点击刷新按钮回到修改前的效果
        $("#d_refresh_button1").click(function () {
            if (nowSrcToServer) {

                $.ajax({
                    type: "get",
                    url: nowSrcToServer,
                    dataType: "text",
                    async: true
                }).done(function (data) {
                    editor1.setValue(data)
                    $("#code").val(data);

                });

            }
        });




    </script>



</body>

</html>